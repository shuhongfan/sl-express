# è¯¾ç¨‹å®‰æ’
- äº†è§£è¿è´¹çš„ä¸šåŠ¡éœ€æ±‚
- äº†è§£è¿è´¹æ¨¡æ¿è¡¨çš„è®¾è®¡
- å®ç°è¿è´¹è®¡ç®—çš„ä¸šåŠ¡é€»è¾‘
- å®Œæˆéƒ¨ç½²æœåŠ¡ä»¥åŠåŠŸèƒ½æµ‹è¯•
# 1ã€èƒŒæ™¯è¯´æ˜

ç°åœ¨å‡ºç°äº†æ–°çš„æƒ…å†µï¼Œå¼€å‘äºŒç»„ä¸€åè´Ÿè´£è¿è´¹å¾®æœåŠ¡çš„åŒäº‹å°å¼ ç¦»èŒäº†ï¼Œå¼€å‘äºŒç»„ç›®å‰äººæ‰‹ä¸è¶³ï¼Œéœ€è¦å€Ÿè°ƒå»æ¥æ‰‹è¿™ä¸ªä»»åŠ¡ï¼Œä½ éœ€è¦çŸ¥é“çš„æ˜¯ï¼Œè¿è´¹è®¡ç®—å¾®æœåŠ¡æ˜¯æ ¸å¿ƒçš„å¾®æœåŠ¡ï¼Œä¸èƒ½å‡ºç°è®¡ç®—é”™è¯¯ï¼Œæ¯•ç«Ÿæ˜¯é’±æŒ‚é’©çš„ã€‚
å¯¹äº†ï¼Œå°å¼ ç¦»èŒå‰å·²ç»å°†è¯¥å¾®æœåŠ¡çš„åŸºæœ¬æ¡†æ¶æ­å»ºå®Œæˆäº†ï¼Œä½ åªéœ€è¦å®ç°æ ¸å¿ƒçš„ä¸šåŠ¡é€»è¾‘å°±å¯ä»¥äº†ï¼Œè¿™å¯¹ä½ æ¥è¯´å¯èƒ½æ˜¯ä¸ªå¥½æ¶ˆæ¯â€¦â€¦

![ksc.gif](https://cdn.nlark.com/yuque/0/2022/gif/27683667/1666061163440-245d2994-ed5a-4f16-bf3e-c09e93a756db.gif#averageHue=%23e5dbc4&clientId=u2cb4a146-73dd-4&errorMessage=unknown%20error&from=paste&height=145&id=u10774757&name=ksc.gif&originHeight=240&originWidth=240&originalType=binary&ratio=1&rotation=0&showTitle=false&size=87077&status=error&style=none&taskId=ua612d619-a61c-4a69-9c27-db4ba21a492&title=&width=145.45453704749963)
# 2ã€éœ€æ±‚åˆ†æ

æ¥åˆ°å¼€å‘ä»»åŠ¡åï¼Œé¦–å…ˆéœ€è¦äº†è§£éœ€æ±‚ï¼Œå†åŠ¨æ‰‹å¼€å‘ã€‚

è¿è´¹çš„è®¡ç®—æ˜¯åˆ†ä¸åŒåœ°åŒºçš„ï¼Œæ¯”å¦‚ï¼šåŒåŸã€çœå†…ã€è·¨çœï¼Œè®¡ç®—è§„åˆ™æ˜¯ä¸ä¸€æ ·çš„ï¼Œæ‰€ä»¥é’ˆå¯¹ä¸åŒçš„ç±»å‹éœ€è¦è®¾ç½®ä¸åŒçš„è¿è´¹è§„åˆ™ï¼Œè¿™å…¶å®å°±æ˜¯æ‰€è°“çš„æ¨¡æ¿ã€‚
## 2.1ã€æ¨¡æ¿åˆ—è¡¨
äº§å“éœ€æ±‚ä¸­çš„è¿è´¹æ¨¡æ¿åˆ—è¡¨ï¼š
![image.png](https://cdn.nlark.com/yuque/0/2022/png/27683667/1672122152999-bf7bae0a-db49-446f-bcc7-81c5d65a16ef.png#averageHue=%23fafafa&clientId=u06a05f29-06e9-4&from=paste&height=373&id=u35f875ea&name=image.png&originHeight=560&originWidth=1240&originalType=binary&ratio=1&rotation=0&showTitle=false&size=43725&status=done&style=shadow&taskId=u58b00630-766a-4c88-8bcc-4a6844fe329&title=&width=826.6666666666666)

:::info
**è½»æŠ›ç³»æ•°åç§°è§£é‡Šï¼š**
 åœ¨è®¡ç®—è¿è´¹æ—¶ï¼ŒåŒ…è£¹æœ‰ä¸¤ä¸ªç»´åº¦ï¼Œä½“ç§¯å’Œé‡é‡ï¼ŒäºŒè€…è°å¤§å–è°è¿›è¡Œè®¡ç®—ï¼Œä½†æ˜¯ä½“ç§¯å’Œé‡é‡ä¸æ˜¯ä¸€ä¸ªå•ä½æ€ä¹ˆæ¯”è¾ƒå‘¢ï¼Ÿä¸€èˆ¬çš„åšæ³•å°±æ˜¯å°†ä½“ç§¯è½¬åŒ–æˆé‡é‡ï¼Œå…¬å¼ï¼šä½“ç§¯ / è½»æŠ›ç³»æ•° = é‡é‡ï¼Œè¿™æ ·å°±å¯ä»¥æ¯”è¾ƒäº†ã€‚
 ä¹Ÿå°±æ˜¯è¯´ï¼Œç›¸åŒçš„ä½“ç§¯ï¼Œè½»æŠ›ç³»æ•°è¶Šå¤§è®¡ç®—å‡ºçš„é‡é‡å°±è¶Šå°ï¼Œåä¹‹å°±è¶Šå¤§ã€‚
:::

## 2.2ã€è®¡è´¹è§„åˆ™

**é‡é‡è®¡ç®—æ–¹æ³•ï¼š**
å–é‡é‡å’Œä½“ç§¯ä¸¤è€…é—´è¾ƒå¤§çš„æ•°å€¼ï¼Œä½“ç§¯è®¡ç®—æ–¹æ³•ï¼šé•¿(cm)Ã—_å®½(cm)_Ã—é«˜(cm) / è½»æŠ›ç³»æ•°

**æ™®å¿«ï¼š**
åŒåŸäº’å¯„ï¼š12000
çœå†…å¯„ä»¶ï¼š8000
è·¨çœå¯„ä»¶ï¼š12000
ç»æµåŒºäº’å¯„ï¼ˆäº¬æ´¥ç¿¼ã€æ±Ÿæµ™æ²ªï¼‰ï¼š6000
ç»æµåŒºäº’å¯„ï¼ˆé»‘å‰è¾½ï¼‰ï¼š12000
ç»æµåŒºäº’å¯„ï¼ˆå·æ¸ï¼‰ï¼š8000

---

**è®¡è´¹é‡é‡å°æ•°ç‚¹è§„åˆ™ï¼š**

ä¸æ»¡1kgï¼ŒæŒ‰1kgè®¡è´¹ï¼›
10KGä»¥ä¸‹ï¼šä»¥0.1kgä¸ºè®¡é‡å•ä½ï¼Œå››èˆäº”å…¥ä¿ç•™ 1 ä½å°æ•°ï¼›
10-100KGï¼šç»­é‡ä»¥0.5kgä¸ºè®¡é‡å•ä½ï¼Œä¸è¶³0.5kgæŒ‰0.5kgç®—ï¼Œå››èˆäº”å…¥ä¿ç•™ 1 ä½å°æ•°ï¼›
100KGåŠä»¥ä¸Šï¼šå››èˆäº”å…¥å–æ•´ï¼›

> **ä¸¾ä¾‹ï¼š**
> 8.4kgæŒ‰ç…§8.4kgæ”¶è´¹
8.5kgæŒ‰ç…§8.5kgæ”¶è´¹
8.8kgæŒ‰ç…§8.8kgæ”¶è´¹
18.1kgæŒ‰ç…§18.5kgæ”¶è´¹
18.5kgæŒ‰ç…§18.5kgæ”¶è´¹
18.7kgæŒ‰ç…§19kgæ”¶è´¹
108.4kgæŒ‰ç…§108kgæ”¶è´¹
108.5kgæŒ‰ç…§109kgæ”¶è´¹
108.6kgæŒ‰ç…§109kgæ”¶è´¹


æ€»è¿è´¹å°æ•°ç‚¹è§„åˆ™ï¼š**æŒ‰å››èˆäº”å…¥è®¡ç®—ï¼Œç²¾ç¡®åˆ°å°æ•°ç‚¹åä¸€ä½**

---

æ¨¡æ¿ä¸å¯é‡å¤è®¾ç½®ï¼Œéœ€ç¡®ä¿å”¯ä¸€å€¼ã€‚
å¦‚å·²è®¾ç½®åŒåŸå¯„ã€è·¨çœå¯„ã€çœå†…å¯„ï¼Œåˆ™åªå¯ä¿®æ”¹ï¼Œä¸å¯å†æ–°å¢
å¦‚å·²è®¾ç½®ç»æµåŒºäº’å¯„æŸä¸ªåŸå¸‚ï¼Œä¸‹æ¬¡æ·»åŠ ä¸å¯å†å…³è”æ­¤ç»æµåŒºåŸå¸‚
## 2.3ã€æ–°å¢æ¨¡æ¿

è¿è´¹æ¨¡æ¿æœ‰4ç§ç±»å‹ï¼Œåˆ†åˆ«ä¸ºï¼š
åŒåŸå¯„ï¼šåŒåŸå¯„ä»¶è¿è´¹è®¡ç®—æ¨¡æ¿ï¼Œå…¨å›½ç»Ÿä¸€å®šä»·
çœå†…å¯„ï¼šçœå†…å¯„ä»¶è¿è´¹è®¡ç®—æ¨¡æ¿ï¼Œå…¨å›½ç»Ÿä¸€å®šä»·
è·¨çœå¯„ï¼šä¸åŒçœä»½é—´çš„è¿è´¹è®¡ç®—æ¨¡æ¿ï¼Œå…¨å›½ç»Ÿä¸€å®šä»·
ç»æµåŒºäº’å¯„ï¼š4ä¸ªç»æµåŒºï¼ˆäº¬æ´¥ç¿¼ã€æ±Ÿæ²ªæµ™çš–ã€å·æ¸ã€é»‘å‰è¾½ï¼‰ï¼Œç»æµåŒºé—´å¯„ä»¶å¯è®¾ç½®ä¼˜æƒ ä»·æ ¼
### 2.3.1ã€å…¨å›½èŒƒå›´
![image-20220802121447879.png](https://cdn.nlark.com/yuque/0/2022/png/27683667/1666061224408-67145457-6c29-4857-bc10-a2ae5ed19b91.png#averageHue=%23f9f9f9&clientId=u2cb4a146-73dd-4&errorMessage=unknown%20error&from=paste&height=403&id=uc5b1f2a8&name=image-20220802121447879.png&originHeight=665&originWidth=892&originalType=binary&ratio=1&rotation=0&showTitle=false&size=29608&status=error&style=none&taskId=u0ec4b121-7144-460b-b465-4765c037575&title=&width=540.6060293598736)

æ­¤æ¨¡æ¿ä¸ºâ€˜åŒåŸå¯„/çœå†…å¯„/è·¨çœâ€™ä¸‰ä¸ªç±»å‹çš„è¿è´¹æ¨¡æ¿
æ¨¡æ¿ç±»å‹ï¼šå¯é€‰æ‹©åŒåŸå¯„/çœå†…å¯„/è·¨çœ/ç»æµåŒºäº’å¯„
è¿é€ç±»å‹ï¼šå¯é€‰æ‹©è¿é€ç±»å‹ï¼Œç›®å‰ä¸šåŠ¡åªæ”¯æŒæ™®å¿«
å…³è”åŸå¸‚ï¼š
åŒåŸå¯„/çœå†…å¯„/è·¨çœï¼šå…¨å›½ç»Ÿä¸€å®šä»·ï¼ˆå¦‚ä¸Šå›¾ï¼‰
é¦–é‡ä»·æ ¼ï¼šä¿ç•™å°æ•°ç‚¹åä¸€ä½ï¼Œå¯è¾“å…¥1-999é—´ä»»æ„æ•°å€¼
ç»­é‡ä»·æ ¼ï¼šä¿ç•™å°æ•°ç‚¹åä¸€ä½ï¼Œå¯è¾“å…¥1-999é—´ä»»æ„æ•°å€¼
è½»æŠ›ç³»æ•°ï¼šæ•´æ•°ï¼Œå¯è¾“å…¥1-99999é—´ï¼Œä»»æ„æ•°å€¼

### 2.3.2ã€ç»æµåŒºäº’å¯„
![image-20220802120200185.png](https://cdn.nlark.com/yuque/0/2022/png/27683667/1666061234916-53bd0d63-2446-4090-9dac-1f419a0d4c53.png#averageHue=%23f9f8f8&clientId=u2cb4a146-73dd-4&errorMessage=unknown%20error&from=paste&height=410&id=udefb6b03&name=image-20220802120200185.png&originHeight=677&originWidth=906&originalType=binary&ratio=1&rotation=0&showTitle=false&size=31603&status=error&style=none&taskId=u74f3f9d7-5461-49b2-b3db-fb051b49787&title=&width=549.090877354311)

æ­¤æ¨¡æ¿ä¸ºâ€˜ç»æµåŒºäº’å¯„â€™ç±»å‹çš„è¿è´¹æ¨¡æ¿
æ¨¡æ¿ç±»å‹ï¼šå¯é€‰æ‹©åŒåŸå¯„/çœå†…å¯„/è·¨çœ/ç»æµåŒºäº’å¯„
è¿é€ç±»å‹ï¼šå¯é€‰æ‹©è¿é€ç±»å‹ï¼Œç›®å‰ä¸šåŠ¡åªæ”¯æŒæ™®å¿«
å…³è”åŸå¸‚ï¼š
ç»æµåŒºäº’å¯„ï¼šå¯è®¾ç½®å•ä¸ªæˆ–å¤šä¸ªç»æµåŒºä»·æ ¼ï¼ˆå¦‚ä¸Šå›¾ï¼‰
é¦–é‡ä»·æ ¼ï¼šä¿ç•™å°æ•°ç‚¹åä¸€ä½ï¼Œå¯è¾“å…¥1-999é—´ä»»æ„æ•°å€¼
ç»­é‡ä»·æ ¼ï¼šä¿ç•™å°æ•°ç‚¹åä¸€ä½ï¼Œå¯è¾“å…¥1-999é—´ä»»æ„æ•°å€¼
è½»æŠ›ç³»æ•°ï¼šæ•´æ•°ï¼Œå¯è¾“å…¥1-99999é—´ï¼Œä»»æ„æ•°å€¼
# 3ã€è¿è´¹æ¨¡æ¿è¡¨

è¿è´¹æ¨¡æ¿æ˜¯éœ€è¦å­˜å‚¨åˆ°è¡¨ä¸­çš„ï¼Œæ‰€ä»¥é¦–å…ˆéœ€è¦è®¾è®¡è¡¨ç»“æ„ï¼Œå…·ä½“è¡¨ç»“æ„è¯­å¥å¦‚ä¸‹ï¼š

```sql
CREATE TABLE `sl_carriage` (
  `id` bigint NOT NULL COMMENT 'è¿è´¹æ¨¡æ¿id',
  `template_type` tinyint NOT NULL COMMENT 'æ¨¡æ¿ç±»å‹ï¼Œ1-åŒåŸå¯„ 2-çœå†…å¯„ 3-ç»æµåŒºäº’å¯„ 4-è·¨çœ',
  `transport_type` tinyint NOT NULL COMMENT 'è¿é€ç±»å‹ï¼Œ1-æ™®å¿« 2-ç‰¹å¿«',
  `associated_city` varchar(20) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL COMMENT 'å…³è”åŸå¸‚ï¼Œ1-å…¨å›½ 2-äº¬æ´¥å†€ 3-æ±Ÿæµ™æ²ª 4-å·æ¸ 5-é»‘å‰è¾½',
  `first_weight` double NOT NULL COMMENT 'é¦–é‡ä»·æ ¼',
  `continuous_weight` double NOT NULL DEFAULT '1' COMMENT 'ç»­é‡ä»·æ ¼',
  `light_throwing_coefficient` int NOT NULL COMMENT 'è½»æŠ›ç³»æ•°',
  `created` datetime DEFAULT NULL COMMENT 'åˆ›å»ºæ—¶é—´',
  `updated` datetime DEFAULT NULL COMMENT 'æ›´æ–°æ—¶é—´',
  PRIMARY KEY (`id`) USING BTREE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci ROW_FORMAT=DYNAMIC COMMENT='è¿è´¹æ¨¡æ¿è¡¨';
```

:::danger
è¯´æ˜ï¼šç”±äºè¯¥è¡¨æ•°æ®æ¯”è¾ƒå°‘ï¼Œæ‰€ä»¥å°±ä¸éœ€è¦æ·»åŠ ç´¢å¼•å­—æ®µäº†ã€‚
:::
åœ¨æ•°æ®åº“ä¸­å·²ç»é¢„å­˜äº†7æ¡æ•°æ®ï¼š
![image.png](https://cdn.nlark.com/yuque/0/2022/png/27683667/1672122238964-3aa23731-3e7e-4363-9f1e-f93f9ddb944a.png#averageHue=%23f6f4f2&clientId=u06a05f29-06e9-4&from=paste&height=163&id=uf93dad5e&name=image.png&originHeight=245&originWidth=1324&originalType=binary&ratio=1&rotation=0&showTitle=false&size=20497&status=done&style=shadow&taskId=uf0179768-8634-4e89-b487-69a318ab5d5&title=&width=882.6666666666666)
> ğŸš¨ ç‰¹åˆ«éœ€è¦æ³¨æ„associated_cityå­—æ®µï¼Œå¦‚æœå¤šä¸ªç»æµåŒºäº’å¯„åŸå¸‚å…±ç”¨ä¸€å¥—æ¨¡æ¿ï¼Œå…¶æ•°æ®æ˜¯é€šè¿‡é€—å·åˆ†å‰²å­˜å‚¨çš„ï¼Œå¦‚ä¸‹ï¼š
> ![image.png](https://cdn.nlark.com/yuque/0/2023/png/27683667/1677809821340-ed3eeb84-5dc0-4798-b0e4-4af4ad0e0252.png#averageHue=%23f8f6f5&clientId=u2334c20e-975c-4&from=paste&height=144&id=u554ff3bb&name=image.png&originHeight=216&originWidth=1011&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=12901&status=done&style=none&taskId=u283a5af1-e5ba-4b19-b768-d9b56bcb84e&title=&width=674)

# 4ã€æ‹‰å–ä»£ç 
éœ€è¦æ‹‰å–çš„å·¥ç¨‹æœ‰3ä¸ªï¼š

| å·¥ç¨‹å | gitåœ°å€ |
| --- | --- |
| sl-express-ms-carriage-domain | [http://git.sl-express.com/sl/sl-express-ms-carriage-domain.git](http://git.sl-express.com/sl/sl-express-ms-carriage-domain.git) |
| sl-express-ms-carriage-api | [http://git.sl-express.com/sl/sl-express-ms-carriage-api.git](http://git.sl-express.com/sl/sl-express-ms-carriage-api.git) |
| sl-express-ms-carriage-service | [http://git.sl-express.com/sl/sl-express-ms-carriage-service.git](http://git.sl-express.com/sl/sl-express-ms-carriage-service.git) |

# 5ã€å®ç°ä¸šåŠ¡
æ¥ä¸‹æ¥æˆ‘ä»¬è¦ç¼–å†™ä»£ç å®ç°å…·ä½“çš„ä¸šåŠ¡äº†ï¼ŒåŒäº‹å°å¼ å·²ç»å®ŒæˆåŸºæœ¬çš„ä»£ç æ¡†æ¶ï¼ŒåŒ…æ‹¬Controllerã€Serviceæ¥å£ç­‰ï¼Œæˆ‘ä»¬åªéœ€è¦å®ç°CarriageServiceå³å¯ã€‚éœ€è¦å®ç°4ä¸ªæ–¹æ³•ï¼Œå¦‚ä¸‹ï¼š
```java
package com.sl.ms.carriage.service;

import com.baomidou.mybatisplus.extension.service.IService;
import com.sl.ms.carriage.domain.dto.CarriageDTO;
import com.sl.ms.carriage.domain.dto.WaybillDTO;
import com.sl.ms.carriage.entity.CarriageEntity;

import java.util.List;

/**
 * è¿è´¹ç®¡ç†è¡¨ æœåŠ¡ç±»
 */
public interface CarriageService extends IService<CarriageEntity> {

    /**
     * æ–°å¢/ä¿®æ”¹è¿è´¹æ¨¡æ¿
     *
     * @param carriageDto æ–°å¢/ä¿®æ”¹è¿è´¹å¯¹è±¡
     *                    å¿…å¡«å­—æ®µï¼štemplateTypeã€transportType
     *                    æ›´æ–°æ—¶ä¼ å…¥idå­—æ®µ
     */
    CarriageDTO saveOrUpdate(CarriageDTO carriageDto);

    /**
     * è·å–å…¨éƒ¨è¿è´¹æ¨¡æ¿
     *
     * @return è¿è´¹æ¨¡æ¿å¯¹è±¡åˆ—è¡¨
     */
    List<CarriageDTO> findAll();

    /**
     * è¿è´¹è®¡ç®—
     *
     * @param waybillDTO è¿è´¹è®¡ç®—å¯¹è±¡
     * @return è¿è´¹æ¨¡æ¿å¯¹è±¡ï¼Œä¸ä»…åŒ…å«æ¨¡æ¿æ•°æ®è¿˜åŒ…å«ï¼šcomputeWeightã€expense å­—æ®µ
     */
    CarriageDTO compute(WaybillDTO waybillDTO);


    /**
     * æ ¹æ®æ¨¡æ¿ç±»å‹æŸ¥è¯¢æ¨¡æ¿ï¼Œç»æµåŒºäº’å¯„ä¸é€šè¿‡è¯¥æ–¹æ³•æŸ¥è¯¢æ¨¡æ¿
     *
     * @param templateType æ¨¡æ¿ç±»å‹ï¼š1-åŒåŸå¯„ï¼Œ2-çœå†…å¯„ï¼Œ4-è·¨çœ
     * @return è¿è´¹æ¨¡æ¿
     */
    CarriageEntity findByTemplateType(Integer templateType);

}

```
## 5.1ã€æŸ¥è¯¢æ¨¡æ¿åˆ—è¡¨
ç¼–å†™`com.sl.ms.carriage.service.impl.CarriageServiceImpl`å®ç°ç±»ï¼š

```java
@Service
public class CarriageServiceImpl extends ServiceImpl<CarriageMapper, CarriageEntity>
        implements CarriageService {

    @Override
    public CarriageDTO saveOrUpdate(CarriageDTO carriageDto) {
        return null;
    }

    @Override
    public List<CarriageDTO> findAll() {
        return null;
    }

    @Override
    public CarriageDTO compute(WaybillDTO waybillDTO) {
        return null;
    }
            
    @Override
    public CarriageEntity findByTemplateType(Integer templateType) {
        if (ObjectUtil.equals(templateType, CarriageConstant.ECONOMIC_ZONE)) {
            throw new SLException(CarriageExceptionEnum.METHOD_CALL_ERROR);
        }
        LambdaQueryWrapper<CarriageEntity> queryWrapper = Wrappers.lambdaQuery(CarriageEntity.class)
                .eq(CarriageEntity::getTemplateType, templateType)
                .eq(CarriageEntity::getTransportType, CarriageConstant.REGULAR_FAST);
        return super.getOne(queryWrapper);
    }
}
```

æŸ¥è¯¢åˆ—è¡¨ï¼Œéœ€è¦æŒ‰ç…§åˆ›å»ºæ—¶é—´å€’åºæ’åºï¼š

```java
    @Override
    public List<CarriageDTO> findAll() {
        // æ„é€ æŸ¥è¯¢æ¡ä»¶ï¼ŒæŒ‰åˆ›å»ºæ—¶é—´å€’åº
        LambdaQueryWrapper<CarriageEntity> queryWrapper = Wrappers.<CarriageEntity>lambdaQuery()
                .orderByDesc(CarriageEntity::getCreated);

        // æŸ¥è¯¢æ•°æ®åº“
        List<CarriageEntity> list = super.list(queryWrapper);

        // å°†ç»“æœè½¬æ¢ä¸ºDTOç±»å‹
        return list.stream().map(CarriageUtils::toDTO).collect(Collectors.toList());
    }
```

ç¼–å†™æµ‹è¯•ç”¨ä¾‹ï¼š

:::danger
å¦‚æœå·¥ç¨‹ä¸­ä¸å­˜åœ¨testç›®å½•ï¼Œéœ€è¦å…ˆåˆ›å»ºtestç›®å½•å†ç¼–å†™æµ‹è¯•ç”¨ä¾‹ï¼š
![image.png](https://cdn.nlark.com/yuque/0/2022/png/27683667/1666786491093-544a5daa-7729-41e0-bc57-887d3f9deb2b.png#averageHue=%23eeeceb&clientId=ue76a18b6-b862-4&from=paste&height=669&id=eOXNE&name=image.png&originHeight=1004&originWidth=1098&originalType=binary&ratio=1&rotation=0&showTitle=false&size=138604&status=done&style=shadow&taskId=u54d1c70e-5849-4794-b496-27421766cd3&title=&width=732)
![image.png](https://cdn.nlark.com/yuque/0/2022/png/27683667/1666786525363-3a4823d1-7ac3-4aa6-a20b-013580642f68.png#averageHue=%23f5f4f4&clientId=ue76a18b6-b862-4&from=paste&height=148&id=u93230818&name=image.png&originHeight=222&originWidth=534&originalType=binary&ratio=1&rotation=0&showTitle=false&size=9186&status=done&style=shadow&taskId=u9ac083d9-9568-4826-9671-5f2cf011a2a&title=&width=356)
:::

![image-20220803165615460.png](https://cdn.nlark.com/yuque/0/2022/png/27683667/1666063150946-1c5db726-14b2-464c-802a-91b595f38338.png#averageHue=%23f1f0f0&clientId=u2cb4a146-73dd-4&errorMessage=unknown%20error&from=paste&height=379&id=tAakl&name=image-20220803165615460.png&originHeight=626&originWidth=898&originalType=binary&ratio=1&rotation=0&showTitle=false&size=45106&status=error&style=none&taskId=u07dab105-640d-46e7-9e10-125a04209f4&title=&width=544.2423927860611)

```java
package com.sl.ms.carriage.service;

import com.sl.ms.carriage.domain.constant.CarriageConstant;
import com.sl.ms.carriage.domain.dto.CarriageDTO;
import com.sl.ms.carriage.entity.CarriageEntity;
import org.junit.jupiter.api.Test;
import org.springframework.boot.test.context.SpringBootTest;

import javax.annotation.Resource;

import java.util.List;

import static org.junit.jupiter.api.Assertions.*;

@SpringBootTest
class CarriageServiceTest {

    @Resource
    private CarriageService carriageService;

    @Test
    void saveOrUpdate() {
    }

    @Test
    void findAll() {
        List<CarriageDTO> list = this.carriageService.findAll();
        for (CarriageDTO carriageDTO : list) {
            System.out.println(carriageDTO);
        }
    }

    @Test
    void compute() {
    }

    @Test
    void findByTemplateType() {
        CarriageEntity carriageEntity = this.carriageService.findByTemplateType(CarriageConstant.SAME_CITY);
        System.out.println(carriageEntity);
    }
}
```

æµ‹è¯•ç»“æœï¼š
![image-20220803165931427.png](https://cdn.nlark.com/yuque/0/2022/png/27683667/1666063166641-8b2a33b3-2988-42a8-96ae-f815818ae9a6.png#averageHue=%23f8f6f5&clientId=u2cb4a146-73dd-4&errorMessage=unknown%20error&from=paste&height=355&id=u359be773&name=image-20220803165931427.png&originHeight=585&originWidth=1509&originalType=binary&ratio=1&rotation=0&showTitle=false&size=64016&status=error&style=none&taskId=u88b65ee1-cc91-4d1d-859f-1e0873a0d01&title=&width=914.5454016861539)
ä¹Ÿå¯ä»¥åŸºäºswaggeræµ‹è¯•ï¼š

urlåœ°å€ï¼š[http://127.0.0.1:18094/doc.html](http://127.0.0.1:18094/doc.html)

å¯ä»¥çœ‹åˆ°ï¼Œå·²ç»æŸ¥è¯¢åˆ°äº†æ•°æ®ï¼š

![image-20220803170150014.png](https://cdn.nlark.com/yuque/0/2022/png/27683667/1666063175569-0ec98072-74ea-49e9-93ac-5977818c1713.png#averageHue=%23fbfbfb&clientId=u2cb4a146-73dd-4&errorMessage=unknown%20error&from=paste&height=415&id=u2a427b63&name=image-20220803170150014.png&originHeight=685&originWidth=1273&originalType=binary&ratio=1&rotation=0&showTitle=false&size=98060&status=error&style=none&taskId=u078c0a7c-4db3-4e3b-912f-ffd3ca94d05&title=&width=771.5151069227793)

æ•´åˆåˆ°åå°ç®¡ç†ç³»ç»Ÿä¸­ï¼š

![image-20220806102317871.png](https://cdn.nlark.com/yuque/0/2022/png/27683667/1666063184804-16848ed4-f5f1-4728-aa44-74e23018c2ed.png#averageHue=%23fbfafa&clientId=u2cb4a146-73dd-4&errorMessage=unknown%20error&from=paste&height=402&id=ue2ec02ca&name=image-20220806102317871.png&originHeight=664&originWidth=1619&originalType=binary&ratio=1&rotation=0&showTitle=false&size=59201&status=error&style=none&taskId=u79576eec-49e9-4b33-9f59-3784834060e&title=&width=981.2120644995912)
## 5.2ã€æ–°å¢æˆ–æ›´æ–°
### 5.2.1ã€æ•´ä½“æµç¨‹
![](https://cdn.nlark.com/yuque/0/2023/jpeg/27683667/1677809486172-2601c3cb-be60-43fc-90ea-69fc0e93b06a.jpeg)

æµç¨‹è¯´æ˜ï¼š

- æ ¹æ®ä¼ å…¥çš„CarriageDTOå¯¹è±¡å‚æ•°è¿›è¡ŒæŸ¥è¯¢æ¨¡æ¿ï¼Œå¹¶ä¸”åˆ¤æ–­æ˜¯å¦ä¸ºç»æµåŒº
- å¦‚æœæ˜¯éç»æµåŒºäº’å¯„ï¼Œéœ€è¦è¿›ä¸€æ­¥åˆ¤æ–­æ¨¡æ¿æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨éœ€è¦åˆ¤æ–­æ˜¯å¦ä¸ºæ–°å¢æ“ä½œï¼Œå¦‚æœæ˜¯æ–°å¢æ“ä½œå°±æŠ›å‡ºå¼‚å¸¸ï¼Œå…¶ä»–æƒ…å†µéƒ½å¯ä»¥è¿›è¡Œè½åº“
- å¦‚æœæ˜¯ç»æµåŒºäº’å¯„ï¼Œéœ€è¦åˆ¤æ–­å…³è”åŸå¸‚æ˜¯å¦é‡å¤ï¼Œå¦‚æœé‡å¤æŠ›å‡ºå¼‚å¸¸ï¼Œå¦åˆ™è¿›è¡Œè½åº“æ“ä½œ
:::danger
â“æ¨¡æ¿ä¸ºä»€ä¹ˆä¸èƒ½é‡å¤ï¼Ÿ
å› ä¸ºè¿è´¹çš„è®¡ç®—æ˜¯é€šè¿‡æ¨¡æ¿è¿›è¡Œçš„ï¼Œå¦‚æœå­˜åœ¨å¤šä¸ªæ¨¡æ¿ï¼Œè¯¥åŸºäºå“ªä¸ªæ¨¡æ¿è®¡ç®—å‘¢ï¼Ÿæ‰€ä»¥æ¨¡æ¿æ˜¯ä¸èƒ½é‡å¤çš„ã€‚
:::
### 5.2.2ã€ä»£ç å®ç°

```java
    @Override
    public CarriageDTO saveOrUpdate(CarriageDTO carriageDto) {
        log.info("æ–°å¢è¿è´¹æ¨¡æ¿ --> {}", carriageDto);
        //æ€è·¯ï¼šé¦–å…ˆæ ¹æ®æ¡ä»¶æŸ¥è¯¢è¿è´¹æ¨¡æ¿ï¼Œåˆ¤æ–­æ¨¡æ¿æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨ç›´æ¥æ–°å¢
        //å¦‚æœå­˜åœ¨ï¼Œéœ€è¦åˆ¤æ–­æ˜¯å¦ä¸ºç»æµåŒºäº’å¯„ï¼Œå¦‚æœä¸æ˜¯ï¼ŒæŠ›å‡ºå¼‚å¸¸ï¼Œå¦‚æœæ˜¯ï¼Œéœ€è¦è¿›ä¸€æ­¥åˆ¤æ–­æ‰€å…³è”çš„åŸå¸‚æ˜¯å¦é‡å¤
        //å¦‚æœé‡å¤ï¼ŒæŠ›å‡ºå¼‚å¸¸ï¼Œå¦‚æœä¸é‡å¤è¿›è¡Œæ–°å¢æˆ–æ›´æ–°
        LambdaQueryWrapper<CarriageEntity> queryWrapper = Wrappers.<CarriageEntity>lambdaQuery()
                .eq(CarriageEntity::getTemplateType, carriageDto.getTemplateType())
                .eq(CarriageEntity::getTransportType, CarriageConstant.REGULAR_FAST);

        //æŸ¥è¯¢åˆ°æ¨¡æ¿åˆ—è¡¨
        List<CarriageEntity> carriageList = super.list(queryWrapper);

        if (ObjectUtil.notEqual(carriageDto.getTemplateType(), CarriageConstant.ECONOMIC_ZONE)) {
            // éç»æµåŒºäº’å¯„çš„æƒ…å†µä¸‹ï¼Œéœ€è¦åˆ¤æ–­æŸ¥è¯¢çš„æ¨¡æ¿æ˜¯å¦ä¸ºç©º
            // å¦‚æœä¸ä¸ºç©ºå¹¶ä¸”å…¥å‚çš„å‚æ•°idä¸ºç©ºï¼Œè¯´æ˜æ˜¯æ–°å¢æ“ä½œï¼Œéç»æµåŒºåªèƒ½æœ‰ä¸€ä¸ªæ¨¡æ¿ï¼Œéœ€è¦æŠ›å‡ºå¼‚å¸¸
            if (ObjectUtil.isNotEmpty(carriageList) && ObjectUtil.isEmpty(carriageDto.getId())) {
                // æ–°å¢æ“ä½œï¼Œæ¨¡æ¿é‡å¤ï¼ŒæŠ›å‡ºå¼‚å¸¸
                throw new SLException(CarriageExceptionEnum.NOT_ECONOMIC_ZONE_REPEAT);
            }
            //æ–°å¢æˆ–æ›´æ–°éç»æµåŒºæ¨¡æ¿
            return this.saveOrUpdateCarriage(carriageDto);
        }

        //åˆ¤æ–­æ¨¡æ¿æ‰€å…³è”çš„åŸå¸‚æ˜¯å¦æœ‰é‡å¤
        //æŸ¥è¯¢å…¶ä»–æ¨¡æ¿ä¸­æ‰€æœ‰çš„ç»æµåŒºåˆ—è¡¨
        List<String> associatedCityList = StreamUtil.of(carriageList)
                //æ’é™¤æ‰è‡ªå·±ï¼Œæ£€æŸ¥ä¸å…¶ä»–æ¨¡æ¿æ˜¯å¦å­˜åœ¨å†²çª
                .filter(carriageEntity -> ObjectUtil.notEqual(carriageEntity.getId(), carriageDto.getId()))
                //è·å–å…³è”åŸå¸‚
                .map(CarriageEntity::getAssociatedCity)
                //å°†å…³è”åŸå¸‚æŒ‰ç…§é€—å·åˆ†å‰²
                .map(associatedCity -> StrUtil.split(associatedCity, ','))
                //å°†ä¸Šé¢å¾—åˆ°çš„é›†åˆå±•å¼€ï¼Œå¾—åˆ°å­—ç¬¦ä¸²
                .flatMap(StreamUtil::of)
                //æ”¶é›†åˆ°é›†åˆä¸­
                .collect(Collectors.toList());

        //æŸ¥çœ‹å½“å‰æ–°å¢ç»æµåŒºæ˜¯å¦å­˜åœ¨é‡å¤ï¼Œå–äº¤é›†æ¥åˆ¤æ–­æ˜¯å¦é‡å¤
        Collection<String> intersection = CollUtil.intersection(associatedCityList, carriageDto.getAssociatedCityList());
        if (CollUtil.isNotEmpty(intersection)) {
            //æœ‰é‡å¤
            throw new SLException(CarriageExceptionEnum.ECONOMIC_ZONE_CITY_REPEAT);
        }
        //æ–°å¢æˆ–æ›´æ–°ç»æµåŒºæ¨¡æ¿
        return this.saveOrUpdateCarriage(carriageDto);
    }
```

### 5.2.3ã€æµ‹è¯•
ç¼–å†™æµ‹è¯•ç”¨ä¾‹ï¼š
```java
    @Resource
    private CarriageService carriageService;

    @Test
    void saveOrUpdate() {
        CarriageDTO carriageDTO = new CarriageDTO();
        carriageDTO.setTemplateType(3);
        carriageDTO.setTransportType(1);
        carriageDTO.setAssociatedCityList(Arrays.asList("5"));
        carriageDTO.setFirstWeight(12d);
        carriageDTO.setContinuousWeight(1d);
        carriageDTO.setLightThrowingCoefficient(6000);

        CarriageDTO dto = this.carriageService.saveOrUpdate(carriageDTO);
        System.out.println(dto);
    }
```
## 5.3ã€è¿è´¹è®¡ç®—
### 5.3.1ã€æ•´ä½“æµç¨‹
![](https://cdn.nlark.com/yuque/0/2022/jpeg/27683667/1672126222980-59d062ee-7055-4dff-9588-809c16713cba.jpeg)

:::info
è¯´æ˜ï¼š

- è¿è´¹æ¨¡æ¿ä¼˜å…ˆçº§ï¼šåŒåŸ>çœå†…>ç»æµåŒºäº’å¯„>è·¨çœ
- å°†ä½“ç§¯è½¬åŒ–æˆé‡é‡ï¼Œä¸é‡é‡æ¯”è¾ƒï¼Œå–å¤§å€¼
:::

### 5.3.2ã€æŸ¥æ‰¾æ¨¡æ¿
åœ¨ä¸Šè¿°çš„æµç¨‹å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œè®¡ç®—è¿è´¹çš„ç¬¬ä¸€æ­¥é€»è¾‘å°±æ˜¯éœ€è¦æŸ¥æ‰¾åˆ°å¯¹åº”çš„è¿è´¹æ¨¡æ¿ï¼Œå¦åˆ™ä¸èƒ½è¿›è¡Œè®¡ç®—ï¼Œå¦‚ä½•å®ç°æ¯”è¾ƒå¥½å‘¢ï¼Œæˆ‘ä»¬è¿™é‡Œé‡‡ç”¨ã€è´£ä»»é“¾ã€‘æ¨¡å¼è¿›è¡Œä»£ç ç¼–å†™ã€‚
ä¹‹æ‰€ä»¥é‡‡ç”¨ã€è´£ä»»é“¾ã€‘æ¨¡å¼ï¼Œæ˜¯å› ä¸ºåœ¨æŸ¥æ‰¾æ¨¡æ¿æ—¶ï¼Œä¸åŒçš„æ¨¡æ¿å¤„ç†é€»è¾‘ä¸åŒï¼Œå¹¶ä¸”è¿™äº›é€»è¾‘ç»„æˆäº†ä¸€æ¡å¤„ç†é“¾ï¼Œæœ‰å¼€å¤´æœ‰ç»“å°¾ï¼Œåªè¦èƒ½æ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„æ¨¡æ¿å³ç»“æŸã€‚

é¦–å…ˆï¼Œå®šä¹‰è¿è´¹æ¨¡æ¿å¤„ç†é“¾ï¼Œè¿™æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼š
```java
package com.sl.ms.carriage.handler;

import com.sl.ms.carriage.domain.dto.WaybillDTO;
import com.sl.ms.carriage.entity.CarriageEntity;

/**
 * è¿è´¹æ¨¡æ¿å¤„ç†é“¾çš„æŠ½è±¡å®šä¹‰
 */
public abstract class AbstractCarriageChainHandler {

    private AbstractCarriageChainHandler nextHandler;

    /**
     * æ‰§è¡Œè¿‡æ»¤æ–¹æ³•ï¼Œé€šè¿‡è¾“å…¥å‚æ•°æŸ¥æ‰¾è¿è´¹æ¨¡æ¿
     *
     * @param waybillDTO è¾“å…¥å‚æ•°
     * @return è¿è´¹æ¨¡æ¿
     */
    public abstract CarriageEntity doHandler(WaybillDTO waybillDTO);

    /**
     * æ‰§è¡Œä¸‹ä¸€ä¸ªå¤„ç†å™¨
     *
     * @param waybillDTO     è¾“å…¥å‚æ•°
     * @param carriageEntity ä¸Šä¸ªhandlerå¤„ç†å¾—åˆ°çš„å¯¹è±¡
     * @return
     */
    protected CarriageEntity doNextHandler(WaybillDTO waybillDTO, CarriageEntity carriageEntity) {
        if (nextHandler == null || carriageEntity != null) {
            //å¦‚æœä¸‹æ¸¸Handlerä¸ºç©º æˆ– ä¸Šä¸ªHandlerå·²ç»æ‰¾åˆ°è¿è´¹æ¨¡æ¿å°±è¿”å›
            return carriageEntity;
        }
        return nextHandler.doHandler(waybillDTO);
    }

    /**
     * è®¾ç½®ä¸‹æ¸¸Handler
     *
     * @param nextHandler ä¸‹æ¸¸Handler
     */
    public void setNextHandler(AbstractCarriageChainHandler nextHandler) {
        this.nextHandler = nextHandler;
    }
}

```
ä¸‹é¢é’ˆå¯¹ä¸åŒçš„æ¨¡æ¿ç­–ç•¥ç¼–å†™å…·ä½“çš„å®ç°ç±»ï¼ŒåŒåŸå¯„ï¼š
```java
package com.sl.ms.carriage.handler;

import com.sl.ms.carriage.domain.constant.CarriageConstant;
import com.sl.ms.carriage.domain.dto.WaybillDTO;
import com.sl.ms.carriage.entity.CarriageEntity;
import com.sl.ms.carriage.service.CarriageService;
import com.sl.transport.common.util.ObjectUtil;
import org.springframework.core.annotation.Order;
import org.springframework.stereotype.Component;

import javax.annotation.Resource;

/**
 * åŒåŸå¯„
 */
@Order(100) //å®šä¹‰é¡ºåº
@Component
public class SameCityChainHandler extends AbstractCarriageChainHandler {

    @Resource
    private CarriageService carriageService;

    @Override
    public CarriageEntity doHandler(WaybillDTO waybillDTO) {
        CarriageEntity carriageEntity = null;
        if (ObjectUtil.equals(waybillDTO.getReceiverCityId(), waybillDTO.getSenderCityId())) {
            //åŒåŸ
            carriageEntity = this.carriageService.findByTemplateType(CarriageConstant.SAME_CITY);
        }
        return doNextHandler(waybillDTO, carriageEntity);
    }
}

```
çœå†…å¯„ï¼š
```java
package com.sl.ms.carriage.handler;

import com.sl.ms.base.api.common.AreaFeign;
import com.sl.ms.carriage.domain.constant.CarriageConstant;
import com.sl.ms.carriage.domain.dto.WaybillDTO;
import com.sl.ms.carriage.entity.CarriageEntity;
import com.sl.ms.carriage.service.CarriageService;
import com.sl.transport.common.util.ObjectUtil;
import org.springframework.core.annotation.Order;
import org.springframework.stereotype.Component;

import javax.annotation.Resource;

/**
 * çœå†…å¯„
 */
@Order(200) //å®šä¹‰é¡ºåº
@Component
public class SameProvinceChainHandler extends AbstractCarriageChainHandler {

    @Resource
    private CarriageService carriageService;
    @Resource
    private AreaFeign areaFeign;

    @Override
    public CarriageEntity doHandler(WaybillDTO waybillDTO) {
        CarriageEntity carriageEntity = null;
        // è·å–æ”¶å¯„ä»¶åœ°å€çœä»½id
        Long receiverProvinceId = this.areaFeign.get(waybillDTO.getReceiverCityId()).getParentId();
        Long senderProvinceId = this.areaFeign.get(waybillDTO.getSenderCityId()).getParentId();
        if (ObjectUtil.equal(receiverProvinceId, senderProvinceId)) {
            //çœå†…
            carriageEntity = this.carriageService.findByTemplateType(CarriageConstant.SAME_PROVINCE);
        }
        return doNextHandler(waybillDTO, carriageEntity);
    }
}

```
ç»æµåŒºäº’å¯„ï¼š
```java
package com.sl.ms.carriage.handler;

import cn.hutool.core.util.ArrayUtil;
import cn.hutool.core.util.EnumUtil;
import com.baomidou.mybatisplus.core.conditions.query.LambdaQueryWrapper;
import com.baomidou.mybatisplus.core.toolkit.Wrappers;
import com.sl.ms.base.api.common.AreaFeign;
import com.sl.ms.carriage.domain.constant.CarriageConstant;
import com.sl.ms.carriage.domain.dto.WaybillDTO;
import com.sl.ms.carriage.domain.enums.EconomicRegionEnum;
import com.sl.ms.carriage.entity.CarriageEntity;
import com.sl.ms.carriage.service.CarriageService;
import com.sl.transport.common.util.ObjectUtil;
import org.springframework.core.annotation.Order;
import org.springframework.stereotype.Component;

import javax.annotation.Resource;
import java.util.LinkedHashMap;

/**
 * ç»æµåŒºäº’å¯„
 */
@Order(300) //å®šä¹‰é¡ºåº
@Component
public class EconomicZoneChainHandler extends AbstractCarriageChainHandler {

    @Resource
    private CarriageService carriageService;
    @Resource
    private AreaFeign areaFeign;

    @Override
    public CarriageEntity doHandler(WaybillDTO waybillDTO) {
        CarriageEntity carriageEntity = null;

        // è·å–æ”¶å¯„ä»¶åœ°å€çœä»½id
        Long receiverProvinceId = this.areaFeign.get(waybillDTO.getReceiverCityId()).getParentId();
        Long senderProvinceId = this.areaFeign.get(waybillDTO.getSenderCityId()).getParentId();

        //è·å–ç»æµåŒºåŸå¸‚é…ç½®æšä¸¾
        LinkedHashMap<String, EconomicRegionEnum> EconomicRegionMap = EnumUtil.getEnumMap(EconomicRegionEnum.class);
        EconomicRegionEnum economicRegionEnum = null;
        for (EconomicRegionEnum regionEnum : EconomicRegionMap.values()) {
            //è¯¥ç»æµåŒºæ˜¯å¦å…¨éƒ¨åŒ…å«æ”¶å‘ä»¶çœid
            boolean result = ArrayUtil.containsAll(regionEnum.getValue(), receiverProvinceId, senderProvinceId);
            if (result) {
                economicRegionEnum = regionEnum;
                break;
            }
        }

        if (ObjectUtil.isNotEmpty(economicRegionEnum)) {
            //æ ¹æ®ç±»å‹ç¼–ç æŸ¥è¯¢
            LambdaQueryWrapper<CarriageEntity> queryWrapper = Wrappers.lambdaQuery(CarriageEntity.class)
                    .eq(CarriageEntity::getTemplateType, CarriageConstant.ECONOMIC_ZONE)
                    .eq(CarriageEntity::getTransportType, CarriageConstant.REGULAR_FAST)
                    .like(CarriageEntity::getAssociatedCity, economicRegionEnum.getCode());
            carriageEntity = this.carriageService.getOne(queryWrapper);
        }

        return doNextHandler(waybillDTO, carriageEntity);
    }
}

```
è·¨çœå¯„ï¼š
```java
package com.sl.ms.carriage.handler;

import com.sl.ms.carriage.domain.constant.CarriageConstant;
import com.sl.ms.carriage.domain.dto.WaybillDTO;
import com.sl.ms.carriage.entity.CarriageEntity;
import com.sl.ms.carriage.service.CarriageService;
import org.springframework.core.annotation.Order;
import org.springframework.stereotype.Component;

import javax.annotation.Resource;

/**
 * è·¨çœ
 */
@Order(400) //å®šä¹‰é¡ºåº
@Component
public class TransProvinceChainHandler extends AbstractCarriageChainHandler {

    @Resource
    private CarriageService carriageService;

    @Override
    public CarriageEntity doHandler(WaybillDTO waybillDTO) {
        CarriageEntity carriageEntity = this.carriageService.findByTemplateType(CarriageConstant.TRANS_PROVINCE);
        return doNextHandler(waybillDTO, carriageEntity);
    }
}

```
ç»„è£…å¤„ç†é“¾ï¼ŒæŒ‰ç…§`@Order`æ³¨è§£ä¸­çš„å€¼ï¼Œç”±å°åˆ°å¤§æ’åºã€‚
```java
package com.sl.ms.carriage.handler;

import cn.hutool.core.collection.CollUtil;
import com.sl.ms.carriage.domain.dto.WaybillDTO;
import com.sl.ms.carriage.entity.CarriageEntity;
import com.sl.transport.common.exception.SLException;
import org.springframework.stereotype.Component;

import javax.annotation.PostConstruct;
import javax.annotation.Resource;
import java.util.List;

/**
 * æŸ¥æ‰¾è¿è´¹æ¨¡æ¿å¤„ç†é“¾ @Orderæ³¨è§£
 */
@Component
public class CarriageChainHandler {

    /**
     * åˆ©ç”¨Springæ³¨å…¥ç‰¹æ€§ï¼ŒæŒ‰ç…§ @Order ä»å°åˆ°è¾¾æ’åºæ³¨å…¥åˆ°é›†åˆä¸­
     */
    @Resource
    private List<AbstractCarriageChainHandler> chainHandlers;

    private AbstractCarriageChainHandler firstHandler;

    /**
     * ç»„è£…å¤„ç†é“¾
     */
    @PostConstruct
    private void constructChain() {
        if (CollUtil.isEmpty(chainHandlers)) {
            throw new SLException("not found carriage chain handler!");
        }
        //å¤„ç†é“¾ä¸­ç¬¬ä¸€ä¸ªèŠ‚ç‚¹
        firstHandler = chainHandlers.get(0);
        for (int i = 0; i < chainHandlers.size(); i++) {
            if (i == chainHandlers.size() - 1) {
                //æœ€åä¸€ä¸ªå¤„ç†é“¾èŠ‚ç‚¹
                chainHandlers.get(i).setNextHandler(null);
            } else {
                //è®¾ç½®ä¸‹æ¸¸èŠ‚ç‚¹
                chainHandlers.get(i).setNextHandler(chainHandlers.get(i + 1));
            }
        }
    }

    public CarriageEntity findCarriage(WaybillDTO waybillDTO) {
        //ä»ç¬¬ä¸€ä¸ªèŠ‚ç‚¹å¼€å§‹å¤„ç†
        return firstHandler.doHandler(waybillDTO);
    }

}

```
æµ‹è¯•ï¼š
```java
package com.sl.ms.carriage.handler;

import com.sl.ms.carriage.domain.dto.WaybillDTO;
import com.sl.ms.carriage.entity.CarriageEntity;
import org.junit.jupiter.api.Test;
import org.springframework.boot.test.context.SpringBootTest;

import javax.annotation.Resource;

@SpringBootTest
class CarriageChainHandlerTest {

    @Resource
    private CarriageChainHandler carriageChainHandler;

    @Test
    void findCarriage() {
        WaybillDTO waybillDTO = WaybillDTO.builder()
                .senderCityId(2L) //åŒ—äº¬
                .receiverCityId(161793L) //ä¸Šæµ·
                .volume(1)
                .weight(1d)
                .build();

        CarriageEntity carriage = this.carriageChainHandler.findCarriage(waybillDTO);
        System.out.println(carriage);
    }
}
```
æ³¨å…¥çš„å¤„ç†é“¾é›†åˆå¯¹è±¡ï¼š
![image.png](https://cdn.nlark.com/yuque/0/2022/png/27683667/1672133403601-474aed4a-1c77-48be-892b-4f00be308fba.png#averageHue=%23f6f5f4&clientId=u06a05f29-06e9-4&from=paste&height=230&id=u81f3ae39&name=image.png&originHeight=345&originWidth=749&originalType=binary&ratio=1&rotation=0&showTitle=false&size=27335&status=done&style=shadow&taskId=u78a6eee6-d9e1-470c-842a-230ed6d72ba&title=&width=499.3333333333333)
æµ‹è¯•ç»“æœï¼ŒæŸ¥è¯¢åˆ°è·¨çœçš„æ¨¡æ¿ï¼Œç»“æœç¬¦åˆé¢„æœŸï¼š
![image.png](https://cdn.nlark.com/yuque/0/2022/png/27683667/1672133594977-ce850e6c-dc1a-460f-aa82-9b155542f758.png#averageHue=%23f7f4f2&clientId=u06a05f29-06e9-4&from=paste&height=367&id=ub9dda73e&name=image.png&originHeight=550&originWidth=1053&originalType=binary&ratio=1&rotation=0&showTitle=false&size=69903&status=done&style=shadow&taskId=u9925589d-1ac2-419e-a751-ebaf8351b14&title=&width=702)
### 5.3.3ã€è®¡ç®—è¿è´¹
```java
    @Override
    public CarriageDTO compute(WaybillDTO waybillDTO) {
        //æ ¹æ®å‚æ•°æŸ¥æ‰¾è¿è´¹æ¨¡æ¿
        CarriageEntity carriage = this.carriageChainHandler.findCarriage(waybillDTO);

        //è®¡ç®—é‡é‡ï¼Œç¡®ä¿æœ€å°é‡é‡ä¸º1kg
        double computeWeight = this.getComputeWeight(waybillDTO, carriage);

        //è®¡ç®—è¿è´¹ï¼Œé¦–é‡ + ç»­é‡
        double expense = carriage.getFirstWeight() + ((computeWeight - 1) * carriage.getContinuousWeight());

        //ä¿ç•™ä¸€ä½å°æ•°
        expense = NumberUtil.round(expense, 1).doubleValue();

        //å°è£…è¿è´¹å’Œè®¡ç®—é‡é‡åˆ°DTOï¼Œå¹¶è¿”å›
        CarriageDTO carriageDTO = CarriageUtils.toDTO(carriage);
        carriageDTO.setExpense(expense);
        carriageDTO.setComputeWeight(computeWeight);
        return carriageDTO;
    }

    /**
     * æ ¹æ®ä½“ç§¯å‚æ•°ä¸å®é™…é‡é‡è®¡ç®—è®¡è´¹é‡é‡
     *
     * @param waybillDTO è¿è´¹è®¡ç®—å¯¹è±¡
     * @param carriage   è¿è´¹æ¨¡æ¿
     * @return è®¡è´¹é‡é‡
     */
    private double getComputeWeight(WaybillDTO waybillDTO, CarriageEntity carriage) {
        //è®¡ç®—ä½“ç§¯ï¼Œå¦‚æœä¼ å…¥ä½“ç§¯ä¸éœ€è¦è®¡ç®—
        Integer volume = waybillDTO.getVolume();
        if (ObjectUtil.isEmpty(volume)) {
            try {
                //é•¿*å®½*é«˜è®¡ç®—ä½“ç§¯
                volume = waybillDTO.getMeasureLong() * waybillDTO.getMeasureWidth() * waybillDTO.getMeasureHigh();
            } catch (Exception e) {
                //è®¡ç®—å‡ºé”™è®¾ç½®ä½“ç§¯ä¸º0
                volume = 0;
            }
        }

        // è®¡ç®—ä½“ç§¯é‡é‡ï¼Œä½“ç§¯ / è½»æŠ›ç³»æ•°
        BigDecimal volumeWeight = NumberUtil.div(volume, carriage.getLightThrowingCoefficient(), 1);

        //å–å¤§å€¼
        double computeWeight = NumberUtil.max(volumeWeight.doubleValue(), NumberUtil.round(waybillDTO.getWeight(), 1).doubleValue());

        //è®¡ç®—ç»­é‡ï¼Œè§„åˆ™ï¼šä¸æ»¡1kgï¼ŒæŒ‰1kgè®¡è´¹ï¼›10kgä»¥ä¸‹ç»­é‡ä»¥0.1kgè®¡é‡ä¿ç•™1ä½å°æ•°ï¼›10-100kgç»­é‡ä»¥0.5kgè®¡é‡ä¿ç•™1ä½å°æ•°ï¼›100kgä»¥ä¸Šå››èˆäº”å…¥å–æ•´
        if (computeWeight <= 1) {
            return 1;
        }

        if (computeWeight <= 10) {
            return computeWeight;
        }

        // ä¸¾ä¾‹ï¼š
        // 108.4kgæŒ‰ç…§108kgæ”¶è´¹
        // 108.5kgæŒ‰ç…§109kgæ”¶è´¹
        // 108.6kgæŒ‰ç…§109kgæ”¶è´¹
        if (computeWeight >= 100) {
            return NumberUtil.round(computeWeight, 0).doubleValue();
        }

        //0.5ä¸ºä¸€ä¸ªè®¡ç®—å•ä½ï¼Œä¸¾ä¾‹ï¼š
        // 18.8kgæŒ‰ç…§19æ”¶è´¹ï¼Œ
        // 18.4kgæŒ‰ç…§18.5kgæ”¶è´¹
        // 18.1kgæŒ‰ç…§18.5kgæ”¶è´¹
        // 18.6kgæŒ‰ç…§19æ”¶è´¹
        int integer = NumberUtil.round(computeWeight, 0, RoundingMode.DOWN).intValue();
        if (NumberUtil.sub(computeWeight, integer) == 0) {
            return integer;
        }
        
        if (NumberUtil.sub(computeWeight, integer) <= 0.5) {
            return NumberUtil.add(integer, 0.5);
        }
        return NumberUtil.add(integer, 1);
    }
```

### 5.3.4ã€æµ‹è¯•
å¯ä»¥é€šè¿‡å•å…ƒæµ‹è¯•æˆ–è€…swaggeræµ‹è¯•ï¼š
```java
    @Test
    void compute() {
        WaybillDTO waybillDTO = new WaybillDTO();
        waybillDTO.setReceiverCityId(7363L); //å¤©æ´¥
        waybillDTO.setSenderCityId(2L); //åŒ—äº¬
        waybillDTO.setWeight(3.8); //é‡é‡
        waybillDTO.setVolume(125000); //ä½“ç§¯

        CarriageDTO compute = this.carriageService.compute(waybillDTO);
        System.out.println(compute);
    }
```
![image-20220804192343311.png](https://cdn.nlark.com/yuque/0/2022/png/27683667/1666063463781-edb6ff39-e821-4b1c-bc94-90b3d0bc1f5d.png#averageHue=%23fbfbfb&clientId=u2cb4a146-73dd-4&errorMessage=unknown%20error&from=paste&height=263&id=Q4WQR&name=image-20220804192343311.png&originHeight=434&originWidth=1277&originalType=binary&ratio=1&rotation=0&showTitle=false&size=46911&status=error&style=none&taskId=u63ed21d9-5ca6-40e2-82b5-b6e3119c1a8&title=&width=773.9393492069042)
![image-20220804192405639.png](https://cdn.nlark.com/yuque/0/2022/png/27683667/1666063463771-21974f54-25bb-4e70-bf93-af1c3fa9a87c.png#averageHue=%23fbfbfb&clientId=u2cb4a146-73dd-4&errorMessage=unknown%20error&from=paste&height=285&id=u9bda2172&name=image-20220804192405639.png&originHeight=470&originWidth=1268&originalType=binary&ratio=1&rotation=0&showTitle=false&size=75852&status=error&style=none&taskId=u082af1e7-721d-4140-9c30-d97d48949f0&title=&width=768.484804067623)
å¯ä»¥çœ‹åˆ°å·²ç»å¾—åˆ°è®¡ç®—ç»“æœã€‚
### 5.3.5ã€å¼‚å¸¸
å¯èƒ½ä¼šå‡ºç°å¦‚ä¸‹å¼‚å¸¸ï¼š
```shell
2022-08-04 19:27:01.712 - [http-nio-18094-exec-6] - ERROR - c.s.t.common.handler.GlobalExceptionHandler - å…¶ä»–æœªçŸ¥å¼‚å¸¸ -> 
feign.RetryableException: Connection refused: connect executing GET http://sl-express-ms-base/area/72975
	at feign.FeignException.errorExecuting(FeignException.java:268)
	at feign.SynchronousMethodHandler.executeAndDecode(SynchronousMethodHandler.java:129)
	at feign.SynchronousMethodHandler.invoke(SynchronousMethodHandler.java:89)
	at feign.ReflectiveFeign$FeignInvocationHandler.invoke(ReflectiveFeign.java:100)
	at com.sun.proxy.$Proxy120.get(Unknown Source)
	at com.sl.ms.carriage.service.impl.CarriageServiceImpl.findEconomicCarriage(CarriageServiceImpl.java:234)
```

ç”±äºåœ¨è®¡ç®—æœåŠ¡ä¸­ä½¿ç”¨baseå¾®æœåŠ¡ï¼Œä½†æ˜¯101æœºå™¨çš„baseæœåŠ¡æ²¡æœ‰å¯åŠ¨ï¼Œä¼šå¯¼è‡´å¦‚ä¸Šå¼‚å¸¸ï¼Œå°†baseå¯åŠ¨å³å¯ã€‚
```shell
#å¯åŠ¨å‘½ä»¤
docker start sl-express-ms-base-service

#æŸ¥çœ‹æ—¥å¿—
docker logs -f sl-express-ms-base-service
```

### 5.3.6ã€æµ‹è¯•ä¸¾ä¾‹

**ä¸¾ä¾‹1ï¼š**è·¨çœå¯„ï¼ˆä¸è¶³1kgï¼‰
ä»åŒ—äº¬å¯„åˆ°ä¸Šæµ·ä¸€ä»¶ç‰©å“ï¼Œç‰©å“é‡é‡0.8åƒå…‹ï¼Œ1ç«‹æ–¹å˜ç±³ï¼ˆé•¿*å®½*é«˜ï¼š1cm*1cm*1cmï¼‰ï¼š
è®¡ç®—ï¼š
é‡é‡ï¼šä¸è¶³1åƒå…‹æŒ‰ç…§ä¸€åƒå…‹è®¡ç®—
ä½“ç§¯ï¼šè·¨çœè½»æŠ›ç³»æ•°ä¸º12000ï¼Œ1ç«‹æ–¹å˜ç±³è®¡ç®—åˆ™ä¸ºï¼š1/12000
å¯¹æ¯”é‡é‡å’Œä½“ç§¯ï¼Œå–å¤§å€¼
æŒ‰ç…§1å…¬æ–¤æ¥è®¡ç®—ï¼Œåˆ™è¿è´¹ä¸ºè·¨çœå¯„è¿è´¹ï¼Œ18å…ƒ

---

**ä¸¾ä¾‹2ï¼š**è·¨çœå¯„(è¶…è¿‡ 1kg)
ä»åŒ—äº¬å¯„åˆ°ä¸Šæµ·ä¸€ä»¶ç‰©å“ï¼Œç‰©å“é‡é‡1.8åƒå…‹ï¼Œ1ç«‹æ–¹å˜ç±³ï¼ˆé•¿*å®½*é«˜ï¼š1cm*1cm*1cmï¼‰ï¼š
è®¡ç®—ï¼š
é‡é‡ï¼š1.8åƒå…‹
ä½“ç§¯ï¼šè·¨çœè½»æŠ›ç³»æ•°ä¸º12000ï¼Œ1ç«‹æ–¹å˜ç±³è®¡ç®—åˆ™ä¸ºï¼š1/12000
å¯¹æ¯”é‡é‡å’Œä½“ç§¯ï¼Œå–å¤§å€¼
æŒ‰ç…§1.8å…¬æ–¤æ¥è®¡ç®—è¿è´¹ï¼Œåˆ™è¿è´¹ä¸ºè·¨çœå¯„è¿è´¹ï¼Œ
1å…¬æ–¤ï¼ˆé¦–é‡ï¼‰+0.8å…¬æ–¤ï¼ˆç»­é‡ï¼‰
æ ¹æ®è¿è´¹è®¡ç®—è§„åˆ™ï¼Œ10å…¬æ–¤ä»¥ä¸‹ä»¥0.1ä¸ºç»­é‡å•ä½ï¼Œåˆ™
é¦–é‡+ç»­é‡=1*18ï¼ˆé¦–é‡ä»·æ ¼ï¼‰+0.8*5=18+4=22å…ƒ

---

**ä¸¾ä¾‹3ï¼š**è·¨çœå¯„ï¼ˆæŒ‰ä½“ç§¯è®¡è´¹ï¼‰
ä»åŒ—äº¬å¯„åˆ°ä¸Šæµ·ä¸€ä»¶ç‰©å“ï¼Œç‰©å“é‡é‡3.8åƒå…‹ï¼Œ125000ç«‹æ–¹å˜ç±³ï¼ˆé•¿*å®½*é«˜ï¼š50cm*50cm*50cmï¼‰ï¼š
è®¡ç®—ï¼š
é‡é‡ï¼š3.8åƒå…‹=3ï¼ˆé¦–é‡ï¼‰+0.8ï¼ˆç»­é‡ï¼‰
ä½“ç§¯ï¼šè·¨çœè½»æŠ›ç³»æ•°ä¸º12000ï¼Œ125000ç«‹æ–¹å˜ç±³ï¼š125000/12000=10.41
å¯¹æ¯”é‡é‡å’Œä½“ç§¯ï¼Œå–å¤§å€¼10.41
æ ¹æ®è¿è´¹è®¡ç®—è§„åˆ™ï¼Œ10-100å…¬æ–¤ä»¥0.5ä¸ºè®¡é‡å•ä½ï¼Œåˆ™10.41ä¸º10.5
é¦–é‡+ç»­é‡=1*18ï¼ˆé¦–é‡ä»·æ ¼ï¼‰+9.5*5=18+47.5=65.5å…ƒ

---

**ä¸¾ä¾‹4ï¼š**åŒåŸå¯„ï¼ˆæŒ‰ä½“ç§¯è®¡è´¹ï¼‰
ä»åŒ—äº¬ä¸œåŸå¯„åˆ°åŒ—äº¬è¥¿åŸä¸€ä»¶ç‰©å“ï¼Œç‰©å“é‡é‡3.8kgï¼Œ125000ç«‹æ–¹å˜ç±³ï¼ˆé•¿*å®½*é«˜ï¼š50cm*50cm*50cmï¼‰ï¼š
è®¡ç®—ï¼š
é‡é‡ï¼š3.8kg=1kgï¼ˆé¦–é‡ï¼‰+2.8kgï¼ˆç»­é‡ï¼‰
ä½“ç§¯ï¼šåŒåŸè½»æŠ›ç³»æ•°ä¸º12000ï¼Œæ¢ç®—æˆé‡é‡125000ç«‹æ–¹å˜ç±³ï¼š125000/12000=10.41kg
å¯¹æ¯”é‡é‡ï¼ˆ3.8kgï¼‰å’Œä½“ç§¯ï¼ˆ10.41kgï¼‰ï¼Œå–å¤§å€¼10.41kg
æ ¹æ®è¿è´¹è®¡ç®—è§„åˆ™ï¼Œ10-100kgä»¥0.5kgä¸ºè®¡é‡å•ä½ï¼Œåˆ™10.41kgä¸º10.5kg
é¦–é‡+ç»­é‡=1kg*12å…ƒï¼ˆé¦–é‡ä»·æ ¼ï¼‰+9.5kg*2å…ƒ(ç»­é‡ä»·æ ¼)=12+19=31å…ƒ

---

**ä¸¾ä¾‹5ï¼š**ç»æµåŒºäº’å¯„ï¼ˆæŒ‰ä½“ç§¯è®¡è´¹ï¼‰
ä»åŒ—äº¬å¯„åˆ°å¤©æ´¥ä¸€ä»¶ç‰©å“ï¼Œç‰©å“é‡é‡3.8kgï¼Œ125000ç«‹æ–¹å˜ç±³ï¼ˆé•¿*å®½*é«˜ï¼š50cm*50cm*50cmï¼‰ï¼š
è®¡ç®—ï¼š
é‡é‡ï¼š3.8kg=1kgï¼ˆé¦–é‡ï¼‰+2.8kgï¼ˆç»­é‡ï¼‰
ä½“ç§¯ï¼šç»æµåŒºäº’å¯„ï¼ˆäº¬æ´¥ç¿¼ï¼‰è½»æŠ›ç³»æ•°ä¸º6000ï¼Œæ¢ç®—æˆä½“ç§¯125000ç«‹æ–¹å˜ç±³ï¼š125000/6000=20.83kg
å¯¹æ¯”é‡é‡(3.8kg)å’Œä½“ç§¯(20.83kg)ï¼Œå–å¤§å€¼20.83kg
æ ¹æ®è¿è´¹è®¡ç®—è§„åˆ™ï¼Œ10-100kgä»¥0.5kgä¸ºè®¡é‡å•ä½ï¼Œåˆ™20.83ä¸º21kg
é¦–é‡+ç»­é‡=1*12å…ƒï¼ˆé¦–é‡ä»·æ ¼ï¼‰+20*5å…ƒ(ç»­é‡ä»·æ ¼)=12+100=112å…ƒ

---

**ä¸¾ä¾‹6ï¼š**çœå†…å¯„ï¼ˆæŒ‰é‡é‡è®¡è´¹ï¼‰
ä»çŸ³å®¶åº„å¯„åˆ°ç§¦çš‡å²›ä¸€ä»¶ç‰©å“ï¼Œç‰©å“é‡é‡3.8kgï¼Œ5000ç«‹æ–¹å˜ç±³ï¼ˆé•¿*å®½*é«˜ï¼š50cm*10cm*10cmï¼‰ï¼š
è®¡ç®—ï¼š
é‡é‡ï¼š3.8kg=1kgï¼ˆé¦–é‡ï¼‰+2.8kgï¼ˆç»­é‡ï¼‰
ä½“ç§¯ï¼šçœå†…å¯„è½»æŠ›ç³»æ•°ä¸º8000ï¼Œæ¢ç®—æˆä½“ç§¯5000ç«‹æ–¹å˜ç±³ï¼š5000/6000=0.8kg
å¯¹æ¯”é‡é‡(3.8kg)å’Œä½“ç§¯(0.8kg)ï¼Œå–å¤§å€¼3.8kg
æ ¹æ®è¿è´¹è®¡ç®—è§„åˆ™ï¼Œ10kgä»¥ä¸‹ä»¥0.1kgä¸ºè®¡é‡å•ä½ï¼Œåˆ™3.8kgä¸º3.8kg
é¦–é‡+ç»­é‡=1*12å…ƒï¼ˆé¦–é‡ä»·æ ¼ï¼‰+2.8*3å…ƒ(ç»­é‡ä»·æ ¼)=12+8.4=20.4å…ƒ
## 5.4ã€éƒ¨ç½²

å·²ç»å°†è¯¥æœåŠ¡çš„éƒ¨ç½²è„šæœ¬å†™åˆ°Jenkinsä¸­ï¼Œç›´æ¥ä½¿ç”¨å³å¯ã€‚

![image-20220805213036091.png](https://cdn.nlark.com/yuque/0/2022/png/27683667/1666063524941-5981dbf3-06a1-4633-a3b9-a6924cff8929.png#averageHue=%23eaeaea&clientId=u2cb4a146-73dd-4&errorMessage=unknown%20error&from=paste&height=555&id=u8dd288f7&name=image-20220805213036091.png&originHeight=916&originWidth=1896&originalType=binary&ratio=1&rotation=0&showTitle=false&size=147372&status=error&style=none&taskId=ufd0e3f24-a526-4e68-9a41-9907848e59a&title=&width=1149.0908426752471)

éƒ¨ç½²æˆåŠŸåè¿›è¡Œæµ‹è¯•ï¼Œç»“æœä¸æœ¬åœ°ä¸€æ ·ã€‚
## 5.5ã€ç”¨æˆ·ç«¯æµ‹è¯•

ç”¨æˆ·ä¸‹å•æ—¶ï¼Œéœ€è¦æ ¹æ®æ”¶å‘åœ°å€è®¡ç®—è¿è´¹ï¼Œæ‰€ä»¥éœ€è¦å°†ç”¨æˆ·ç«¯è¿è¡Œèµ·æ¥è¿›è¡ŒåŠŸèƒ½æµ‹è¯•ã€‚
ç”¨æˆ·ç«¯çš„éƒ¨ç½²å‚è€ƒ[ã€Šå‰ç«¯éƒ¨ç½²æ–‡æ¡£ã€‹](https://www.yuque.com/docs/share/90dee639-d6a5-48c7-a644-4829db1e47ae)ã€‚

éœ€è¦å¯åŠ¨å¦‚ä¸‹æ‰€éœ€è¦çš„æœåŠ¡ï¼Œè¿›è¡Œæµ‹è¯•ï¼š
![image.png](https://cdn.nlark.com/yuque/0/2022/png/27683667/1666334786914-76e2d013-5715-4b8a-8f17-30a68ac5d1e4.png#averageHue=%2310131e&clientId=uda74feab-7c4a-4&from=paste&height=349&id=u2d526d4b&name=image.png&originHeight=524&originWidth=1666&originalType=binary&ratio=1&rotation=0&showTitle=false&size=78713&status=done&style=none&taskId=u7e2b4bf8-aea1-475f-8b75-ad9fbe0471a&title=&width=1110.6666666666667)

å¦‚æœå‡ºç°å¦‚ä¸‹é”™è¯¯ï¼Œæ˜¯å› ä¸º `sl-express-ms-oms-service` æœåŠ¡æ²¡æœ‰å¯åŠ¨ã€‚

![image.png](https://cdn.nlark.com/yuque/0/2022/png/27683667/1666334475848-85b2fe09-1c9b-439f-9f3c-7f6d36dd8105.png#averageHue=%23d3b589&clientId=uda74feab-7c4a-4&from=paste&height=531&id=BlJVa&name=image.png&originHeight=797&originWidth=473&originalType=binary&ratio=1&rotation=0&showTitle=false&size=69840&status=done&style=none&taskId=u81d1d83f-887f-410e-a03c-4b4c35dff5c&title=&width=315.3333333333333)

æµ‹è¯•ç»“æœå¦‚ä¸‹ï¼š

![image.png](https://cdn.nlark.com/yuque/0/2022/png/27683667/1666334630525-78698a87-c3a5-411f-aa06-0c9d71e1e5f8.png#averageHue=%23dad5d5&clientId=uda74feab-7c4a-4&from=paste&height=522&id=ufb543322&name=image.png&originHeight=783&originWidth=474&originalType=binary&ratio=1&rotation=0&showTitle=false&size=50639&status=done&style=none&taskId=u0a61ca31-13b1-494c-994c-175cb5b9694&title=&width=316)
# 6ã€ç»ƒä¹ 

éœ€æ±‚ï¼šè®¡ç®—è¿è´¹çš„ç¬¬ä¸€æ­¥å°±æ˜¯æ ¹æ®å‚æ•°æŸ¥è¯¢è¿è´¹æ¨¡æ¿ï¼Œè€Œè¿™ä¸ªåŠ¨ä½œä¼šè®¿é—®æ•°æ®åº“ï¼Œå¹¶ä¸”æ˜¯æ¯”è¾ƒé¢‘ç¹çš„ï¼Œç„¶è€Œè¿è´¹æ¨¡æ¿çš„å˜æ›´å¹¶ä¸é¢‘ç¹ï¼Œéœ€è¦å¯ä»¥å°†è¿è´¹æ¨¡æ¿ç¼“å­˜èµ·æ¥ï¼Œä»¥æé«˜æ•ˆç‡ã€‚

æç¤ºï¼š

- éœ€è¦å¼•å…¥redisç›¸å…³çš„ä¾èµ–
- å¢åŠ redisç›¸å…³çš„é…ç½®
- ç¼–ç å®ç°ç¼“å­˜ç›¸å…³é€»è¾‘
# 7ã€é¢è¯•è¿ç¯é—®
:::info
é¢è¯•å®˜é—®ï¼š

- ä½ ä»¬çš„è¿è´¹æ˜¯æ€ä¹ˆè®¡ç®—çš„ï¼Ÿä½“ç§¯å’Œé‡é‡æ€ä¹ˆè®¡ç®—ï¼Œåˆ°åº•ä»¥å“ªä¸ªä¸ºå‡†ï¼Ÿ
- è¯¦ç»†èŠèŠä½ ä»¬çš„è¿è´¹æ¨¡æ¿æ˜¯åšä»€ä¹ˆçš„ï¼Ÿ
- æœ‰æ²¡æœ‰é’ˆå¯¹è¿è´¹è®¡ç®—åšä»€ä¹ˆä¼˜åŒ–ï¼Ÿ
:::
